# アプリケーション テスト仕様書

## 1. テスト対象
このドキュメントは、「献立アシスタント」アプリケーションのフロントエンドおよびバックエンドのテスト仕様を定義します。

---

## 2. フロントエンド テスト仕様

### 2.1. テスト対象
- `static/index.html`

### 2.2. テスト環境
- ブラウザ: Google Chrome

### 2.3. テスト項目

#### 2.3.1. 初期表示
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 1-1 | 初期画面表示 | `http://localhost:5000/` にアクセスする | - "献立アシスタント"というタイトルが表示される。<br>- チャット欄にAIからの初期メッセージが表示される。<br>- テキスト入力エリア、条件ボタン、献立作成ボタンが表示されている。 |OK|正常動作 |
| 1-2 | ボタン初期状態 | 画面をロードする | - 「献立を作成」ボタンが有効。<br>- 「調理時間」「ジャンル」ボタンが有効。 |OK|正常動作 |

#### 2.3.2. チャット機能
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 2-1 | テキスト入力と送信 | テキストエリアに文字を入力し、「献立を作成」ボタンをクリックする | - ユーザーの入力内容が右側に青い吹き出しで表示される。<br>- AIからの応答が左側に白い吹き出しで表示される。<br>- 送信後、テキストエリアが空になる。 |OK |正常動作 |
| 2-2 | Enterキーでの送信 | テキストエリアに文字を入力し、Enterキーを押す | 2-1と同様の結果になる。 |OK|正常動作 |
| 2-3 | Shift+Enterでの改行 | テキストエリアでShift+Enterキーを押す | メッセージは送信されず、テキストエリア内で改行される。 |NG |機能として必要ないためとりあえずは無視する |
| 2-4 | 送信中のUI状態 | 「献立を作成」ボタンをクリックする | - 「献立を作成」ボタン、条件ボタン、テキストエリアが無効化される。<br>- 「献立を作成」ボタン内にスピナーが表示される。<br>- 応答後、ボタンとテキストエリアが再度有効になる。 |OK |正常動作 |
| 2-5 | 自動スクロール | チャットのメッセージが増えて画面に収まらなくなる | 新しいメッセージが追加されるたびに、チャット履歴が最下部まで自動でスクロールする。 |OK |正常動作 |

#### 2.3.3. 条件指定機能
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 3-1 | 条件ボタンでの献立作成 | テキストエリアを空のまま、「調理時間: 15分」「ジャンル: 和食」を選択して「献立を作成」ボタンをクリックする | - ユーザーメッセージとして「調理時間: 15分、ジャンル: 和食 の条件で献立を作成」が右側に表示される。<br>- AIから条件に合った応答が返る。<br>- 送信後、選択されていた条件ボタンがリセット（非選択状態に）される。 |OK |正常動作 |
| 3-2 | 条件ボタンの選択・解除 | 「調理時間: 15分」ボタンを1回クリックし、もう一度クリックする | - 1回目のクリックでボタンが選択状態（色が濃く）になる。<br>- 2回目のクリックでボタンが非選択状態に戻る。 |OK |正常動作 |
| 3-3 | 入力と条件の組み合わせ | テキストエリアに「豚肉」と入力し、「ジャンル: 中華」を選択して「献立を作成」ボタンをクリックする | - ユーザーメッセージとして「豚肉」が右側に表示される。<br>- AIから「豚肉を使った中華料理」の献立が返る。 |OK |正常動作 |

#### 2.3.4. 献立履歴機能
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 4-1 | モーダル表示 | 「献立履歴」ボタンをクリックする | 献立履歴のモーダルウィンドウが表示される。 |OK |正常動作 |
| 4-2 | 履歴がない場合 | 献立が一度も作成されていない状態でモーダルを開く | 「履歴はまだありません。」と表示される。 |OK |正常動作 |
| 4-3 | 履歴の表示 | AIから献立が返ってきた後、モーダルを開く | - 献立名がアコーディオン形式で表示される。<br>- 献立名をクリックすると、材料と分量の一覧が展開される。 |OK |正常動作 |
| 4-4 | 買い物リストへの追加 | 献立の詳細を開き、「この献立を買い物リストに追加」ボタンをクリックする | - ボタンの表示が「追加済み」に変わり、無効化される。<br>- 買い物リストにその献立の材料が追加される（重複はしない）。 |OK |正常動作 |

#### 2.3.5. 買い物リスト機能
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 5-1 | モーダル表示 | 「買い物リスト」ボタンをクリックする | 買い物リストのモーダルウィンドウが表示される。 |OK |正常動作 |
| 5-2 | リストが空の場合 | 材料が追加されていない状態でモーダルを開く | 「買い物リストは空です。」と表示される。 |OK | 正常動作|
| 5-3 | バッジの件数表示 | 献立履歴から材料を買い物リストに追加する | 「買い物リスト」ボタンの横のバッジに、リスト内の材料の総数が表示される。 |OK |正常動作 |
| 5-4 | 材料の表示と削除 | 材料が追加された状態でモーダルを開き、特定の材料の「削除」ボタンをクリックする | - 材料名と分量の一覧が表示される。<br>- 「削除」ボタンを押した材料がリストから消える。<br>- バッジの件数が1減る。 |OK |正常動作 |
| 5-5 | すべてクリア | モーダル内の「すべてクリア」ボタンをクリックする | - 買い物リストがすべて空になる。<br>- バッジが消える。<br>- 献立履歴の「追加済み」ボタンがすべてリセットされる。 |OK |正常動作 |

#### 2.3.6. エラー表示
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 6-1 | APIエラー | サーバーが500エラーを返した場合 | チャット欄に「エラー: AIサービスとの通信中にエラーが発生しました。」といったメッセージがAI応答として表示される。 |OK |正常動作 |
| 6-2 | ネットワークエラー | サーバーを停止させた状態で「献立を作成」ボタンをクリックする | チャット欄に「エラー: ネットワーク接続に問題があるか、サーバーが応答していません。」といったメッセージがAI応答として表示される。 |OK |正常動作 |

---

## 3. バックエンド テスト仕様

### 3.1. テスト対象
- `app.py`

### 3.2. テスト環境
- Python 3.x
- Flask, openai, python-dotenv
- APIテストツール (例: Postman, curl)

### 3.3. テスト項目

#### 3.3.1. サーバー起動・静的ファイル配信
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 1-1 | サーバー起動 | `python app.py` を実行する | - エラーなくサーバーが起動する。<br>- `* Running on http://127.0.0.1:5000` と表示される。 | OK |正常動作 |
| 1-2 | APIキー未設定での起動 | `.env` ファイルが存在しない、または `OPENROUTER_API_KEY` が空の状態でサーバーを起動する | `警告: 環境変数 OPENROUTER_API_KEY が設定されていません。` というメッセージがコンソールに表示される。 |OK |正常動作 |
| 1-3 | 静的ファイル配信 | ブラウザまたはcurlで `http://localhost:5000/` にGETリクエストを送信する | - ステータスコード200が返る。<br>- レスポンスボディに `index.html` の内容が含まれている。 |OK |正常動作 |

#### 3.3.2. API `/send_api` [POST] - 正常系
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 2-1 | 基本的なリクエスト | 条件または材料をリクエストボディとして送信する |応答が返ってくる |OK |正常動作 |
| 2-2 | 調理時間、ジャンルによる条件絞り込みボタンを押した状態でのリクエスト | 条件または材料を入力して調理時間またはジャンルのボタンを押した状態でを送信する | 調理時間、ジャンルに対応した応答が返ってくる |OK |正常動作 |

#### 3.3.3. API `/send_api` [POST] - 異常系
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 3-1  | APIキー未設定 | OPENROUTER_API_KEY未設定で起動 | エラー: OpenRouter API key is not configured on the server. |OK|正常動作 |
| 3-2  | AI応答なし | AIから応答がない場合 | "AIから有効な応答がありませんでした。"が返る |OK|正常動作 |
| 3-3  | 通信エラー | OpenRouter API通信不可 | エラー: AIサービスとの通信中にエラーが発生しました。 |OK|正常動作 |

#### 3.3.4. OpenRouter API連携
| No | テスト項目 | 手順 | 期待結果 | 結果 (OK/NG) | 備考 |
|----|----------|------|----------|:----------:|:----|
| 4-1 | ヘッダー情報 | `.env` に `YOUR_SITE_URL` と `YOUR_APP_NAME` を設定してAPIを呼び出す | OpenRouterのログ上で、リクエストヘッダーに `HTTP-Referer` と `X-Title` が正しく設定されていることを確認する。（手動確認） |NG |見つからなかった |
| 4-2 | モデル指定 | `app.py` の `model` パラメータが `"google/gemma-3-27b-it:free"` になっていることを確認してAPIを呼び出す | OpenRouterのログ上で、指定したモデルが使用されていることを確認する。（手動確認） |NG |見つからなかった |
